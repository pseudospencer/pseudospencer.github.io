<!DOCTYPE html>
<html>

<head>
    <!-- A-frame -->
    <script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
    <!-- A-frame Environment -->
    <script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>
    <!-- Cannon Physics -->
    <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v1.4.2/dist/aframe-physics-system.min.js"></script>

    <script src="/components/auto-reset-position.js"></script>
    <script src="/components/random-color.js"></script>
</head>

<body>
    <a-scene physics="debug: true; gravity: -7">

        <a-assets>
            <!-- Goat -->
            <a-asset-item id="goat-obj" src="/models/goat.obj"></a-asset-item>
            <!-- Wolf -->
            <a-asset-item id="rat-obj" src="/models/rat.obj"></a-asset-item>
            <!-- Rat -->
            <a-asset-item id="wolf-obj" src="/models/wolf.obj"></a-asset-item>
            <!-- Prince's "When Doves Cry" -->
            <audio id="when-doves-cry" loop="true" src="/audio/when_doves_cry.mp3"></audio>
        </a-assets>

        <!-- ENVIRONMENT - kind of a vaporwave mushroom land-->
        <!-- <a-entity id="environment" environment="preset: tron; skyColor: #9e15f3; horizonColor: #21fc64; shadow: true; fog: 0.21; ground: noise; groundYScale: 10; groundColor: #2714b8; dressing: mushrooms; dressingColor: #fd8d70; dressingVariance: 18 5 20; gridColor: #e22c88"> -->
        <a-entity id="environment" environment="preset: tron; skyColor: #9e15f3; horizonColor: #21fc64; shadow: true; fog: 0.21; groundYScale: 10; groundColor: #2714b8; dressing: mushrooms; dressingColor: #fd8d70; dressingVariance: 18 5 20; gridColor: #e22c88">
            <a-plane static-body width="200" height='200' rotation="90 0 0"></a-plane>
        </a-entity>

        <!-- Camera -->
        <a-entity id="camera" camera="userHeight: 1" position="0 1 2" rotation="0 180 0" look-controls wasd-controls>
            <!-- Audio Container -->
            <a-entity id="prince-player" sound="src: #when-doves-cry; loop: true;" soundplaybackrate="1"></a-entity>
        </a-entity>

        <!-- Ambient light -->
        <a-entity light="type: ambient; intensity: .2"></a-entity>

    </a-scene>

    <script type="text/javascript">
        let scene = document.querySelector('a-scene');
        let camera = document.querySelector("#camera");

        let environment = document.querySelector("#environment");

        let goat = createGoat(0, -1, -4, camera);
            goat.setAttribute("id", "mrGoat");
            goat.setAttribute("static-body", 'shape: box;');
            goat.setAttribute("rotation", {x: 0, y: 90, z: 10});

        let wolves = [];

        for (let i = 0; i < 10; i++){
            wolves[i] = createWolf(i, 20, 20);
            wolves[i].setAttribute("dynamic-body", "mass: 1;");
            wolves[i].setAttribute("random-color","");
            wolves[i].setAttribute("scale", ".004 .004 .004");
            // wolves[i].setAttribute('auto-reset-position', "");
            console.log(wolves[i].attributes);
            console.log(wolves[i].body);
        }

        // Functions
        function createGoat(x, y, z, appendTo = scene) {
            let goat = document.createElement("a-entity");
            goat.setAttribute('obj-model', "obj", "#goat-obj");
            goat.setAttribute("class", "goat");
            goat.setAttribute("position", `${x} ${y} ${z}`);
            goat.setAttribute("material", "color: pink;");
            goat.setAttribute("scale", ".002 .002 .002");

            appendTo.appendChild(goat);
            return goat;
        }

        function createWolf(x, y, z, appendTo = scene) {
            let wolf = document.createElement("a-entity");
            wolf.setAttribute("obj-model", "obj", "#wolf-obj");
            wolf.setAttribute("class", "wolf");
            wolf.setAttribute("position", `${x} ${y} ${z}`);
            wolf.setAttribute("material", "color: green;");
            wolf.setAttribute("scale", ".002 .002 .002");

            appendTo.appendChild(wolf);
            return wolf;
        }

        function createRat(x, y, z, appendTo = scene) {
            let rat = document.createElement("a-entity");
            rat.setAttribute("obj-model", "obj", "#rat-obj");
            rat.setAttribute("class", "rat");
            rat.setAttribute("position", `${x} ${y} ${z}`);
            rat.setAttribute("material", "color: gold;");
            rat.setAttribute("scale", ".02 .02 .02");

            appendTo.appendChild(rat);
            return rat;
        }

        function addRotateAnimation(eleToAnimate, x =0, y = 90, z = 90) {
            let animation = document.createElement("a-animation");
            animation.setAttribute("attribute", "rotation");
            animation.setAttribute("dur", "1000");
            animation.setAttribute("repeat", "indefinite");
            animation.setAttribute('direction', "alternate");
            animation.setAttribute("to", `${x} ${y} ${z}`);

            eleToAnimate.appendChild(animation);

        }

        function addJumpAnimation(eleToAnimate, jumpHeight = 3) {
            let animation = document.createElement("a-animation");
            animation.setAttribute("attribute", "position");
            animation.setAttribute("dur", "1000");
            animation.setAttribute("repeat", "indefinite");
            animation.setAttribute('direction', "alternate");
            animation.setAttribute("to", `${eleToAnimate.object3D.position.x} ${eleToAnimate.object3D.position.y + jumpHeight} ${eleToAnimate.object3D.position.z}`);
            animation.setAttribute("delay", "100");

            eleToAnimate.appendChild(animation);
        }

        // Autoplay Music
        document.querySelector('a-scene').addEventListener('loaded', function() {
            let iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            if (iOS) {
                function startAudio() {
                    let entity = document.querySelector('#prince-player');
                    entity.components.sound.playSound();

                    document.body.removeEventListener('click', startAudio);
                }
                document.body.addEventListener('click', startAudio);
            } else {
                let entity = document.querySelector('#prince-player');
                entity.components.sound.playSound();
            }
        })
    </script>
</body>

</html>
